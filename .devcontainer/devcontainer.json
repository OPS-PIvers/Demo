{
  "name": "GAS + Gemini Pro Agent",
  "image": "mcr.microsoft.com/devcontainers/javascript-node:20",

  "onCreateCommand": "npm install -g @google/clasp@latest @google/gemini-cli@latest @types/google-apps-script",

  "postCreateCommand": "bash -c 'mkdir -p src .gemini/commands .gemini/skills/gas-pro .vscode && if [ ! -f .clasp.json ]; then echo \"{\\\"scriptId\\\":\\\"\\\",\\\"rootDir\\\":\\\"./src\\\"}\" > .clasp.json; fi && echo -e \"**/**\\n!src/**\\n!appsscript.json\\n.devcontainer/\\n.gemini/\" > .claspignore && if [ ! -f src/appsscript.json ]; then echo \"{\\\"timeZone\\\":\\\"America/New_York\\\",\\\"exceptionLogging\\\":\\\"STACKDRIVER\\\",\\\"runtimeVersion\\\":\\\"V8\\\"}\" > src/appsscript.json; fi && cat <<EOF > .gemini/commands/deploy.toml\ndescription = \"Update Web App\"\nprompt = \"\"\"\n1. Run clasp push --force.\n2. Run clasp deployments.\n3. Find the ID for web app.\n4. Run clasp deploy -i <ID>.\n\"\"\"\nEOF\ncat <<EOF > .gemini/commands/auth.toml\ndescription = \"Auth Clasp\"\nprompt = \"\"\"\n1. Run clasp login --no-localhost.\n2. Tell user to open the link in a new tab and authorize.\n3. WARN THEM: The final page will crash (localhost refused to connect). This is expected!\n4. Tell them to copy the URL of that crashed page and paste it into the terminal.\n\"\"\"\nEOF\ncat <<EOF > .gemini/skills/gas-pro/SKILL.md\n---\nname: gas-pro\ndescription: Expertise in GAS V8 and Troubleshooting\n---\n- Troubleshooting: If clasp push fails, check https://script.google.com/home/usersettings and enable \"Google Apps Script API\".\n- Auto-Doc: Generate JSDoc headers for .gs functions when asked.\nEOF\ncat <<EOF > GEMINI.md\n# Project Context\n- Code is in /src. Manifest is at /src/appsscript.json.\n- Deployment: Use /deploy to update production.\nEOF\necho -e \"# ðŸš€ Pro Setup Guide\\n\\n### 1. The Clasp Auth (Careful!)\\n1. Run \\`clasp login --no-localhost\\` in the terminal below.\\n2. Click the link to open it in a new tab.\\n3. Accept permissions with your Google Account.\\n4. **CRITICAL:** The final page will fail to load (e.g. \\\"Site can't be reached\\\"). **Do not panic.**\\n5. Copy the address of that failed page (starts with \\`http://localhost...\\`) from your browser bar.\\n6. Paste it back into the terminal below.\\n\\n### 2. The Gemini Auth\\nRun \\`gemini\\` and follow the prompts.\\n\\n### 3. Permissions\\nEnable API: https://script.google.com/home/usersettings\" > GUIDE.md && echo \"{\\\"version\\\":\\\"2.0.0\\\",\\\"tasks\\\":[{\\\"label\\\":\\\"ðŸ”´ Setup Required\\\",\\\"type\\\":\\\"shell\\\",\\\"command\\\":\\\"echo \\\\\\\"âš ï¸ READ THE GUIDE ABOVE: You must paste the 'dead' localhost URL back here!\\\\\\\"\\\",\\\"presentation\\\":{\\\"reveal\\\":\\\"always\\\",\\\"panel\\\":\\\"new\\\"},\\\"runOptions\\\":{\\\"runOn\\\":\\\"folderOpen\\\"}}]}\" > .vscode/tasks.json && code GUIDE.md'",

  "customizations": {
    "vscode": {
      "settings": {
        "editor.formatOnSave": true,
        "files.associations": { "*.gs": "javascript" },
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "google.gemini.chat.visible": false,
        "workbench.editor.enablePreview": false
      },
      "extensions": [
        "Google.geminicodeassist",
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode"
      ]
    }
  },

  "remoteUser": "node"
}
